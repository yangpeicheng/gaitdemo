<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Demo</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
</head>
<body>
    <div class="container theme-showcase" role="main" >
        <div class="jumbotron">
            <h2> Gait Analysis Demo </h2>
            <div class="row">
                <div class="col-lg-6 col-sm-6 col-12">
                    <h4>Select File</h4>
                    <div class="input-group">
                        <label class="input-group-btn">
                            <span class="btn btn-primary">
                                Browse&hellip; <input type="file" style="display: none;" multiple>
                            </span>
                        </label>
                        <input type="text" class="form-control" readonly>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-4">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">Animation</h3>
                    </div>
                    <div class="panel-body">
                        <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" width="325" height="380" viewBox="15 0 315 315">
                            <circle fill="white" cx="172" cy="165" r="150" stroke='rgba(255,255,255,.4)' stroke-width='30'/>
                            <ellipse id="mSH" opacity='.2' cx="175" cy="313" rx="110" ry="10"/>
                            <g id="B">
                                <g id="UB">
                                <g id="H">
                                    <path d="M188.8.2c-9.1-.3-16.2 7.3-16.2 15.4 0 8.9 7.2 13.8 7.2 13.8s1.3 3.8 0 6.9c-2.1 4.8-6.6 11.1-6.6 11.1l17.6 8.9s-3.8-8.4-2.2-13.8c.8-2.9 4.7-3.5 6.9-3.1 3.8 3.7 7.7 5.5 9.1 4.6 1.9-1.2 4.9-18.4 4.5-26.8-.4-8.5-9.5-16.3-20.3-17z"/>
                                    <g fill='none' stroke='#fff' opacity='0.4'>
                                    <path d="M191.1.3s4 4.4 4.9 17.9-.9 21-.9 21"/>
                                    <path d="M172.6 16.2s8.2 2.1 19.2 2.4c11.5.3 17.4-1.5 17.4-1.5"/>
                                    </g>
                                    <g fill='none' stroke='#fff' opacity='0.7' stroke-linecap='round' stroke-width='3' >
                                        <path class="st4" d="M181,7.1c-0.8,0.7-1.6,1.4-2.2,2.3"/>
                                    <path class="st4" d="M198.6,7.6c-4.1-2.8-9.3-4.3-14-2.6"/>
                                    </g>
                                </g>
                                <path d="M196.9 83.1c-1.6 8-2.9 14.6-2.9 14.6l-4.9 46.1-21.9-7.7 3.4-11c.7-3.7.9-8.5.4-12.3-4.272-29.697-8.373-41.774-5.7-52.182 2.043-6.93 9.2-17.518 9.2-17.518s3.7 1.4 6.6 2.2c3.5 1.2 8.3 2.9 8.3 2.9s10 21.9 7.5 34.9z"/>
                                <path class="FB" fill='#DC0026' d="M167.5 132.7c-9 18.6 6.4 27.6 10.6 27.6 6 0 11.8-9.2 12.3-24.1l-22.9-5.7v2.2z"/>
                                </g>
                                <g id="thighright" fill='#A50018'>
                                <path  d="M169.2 223.345c.1-.21-.4-2.11 1.4-20.466-1.9-15.51-4.6-39.88-1.2-52.86 2.9-12.66 16.7-15.83 19.1-1.588.4 11.183.4 15.51-2 35.66-4.6 23.313-9.7 39.243-9.8 40.09-.1.525-2.2 2.32-4.4 2.002-1.7.104-3.3-2.217-3.1-2.85z"/>
                                <g class="F1" id="shankright">
                                    <path  d="M162.9 307.954s1.2-11.393.3-24.264c-.5-9.284-5.8-30.594-4.7-38.93 6.8-18.777 13.6-23.42 16.4-22.26 1.1.95 1.9 2.322 1.3 4.01-.1.106-3.8 23.632-6 40.3-2.3 18.04.7 41.144.7 41.144h-8z"/>
                                    <g class="F2" id="footright">
                                    <path d="M192.2 316.183s-25.4-16.985-28.8-14.242c-1.4 6.65-11.8 19.1-2.9 22.9 3.3 1.27 7-1.16 8.3-1.37 6.3-1.16 19.1 1.48 20.2 1.48 2.8 0 5.1-1.687 5.1-4.64 0-1.69-.8-3.27-1.9-4.116z"/>
                                    <path class="F3" d="M191.7 315.867s-1.5-.528-2.3-.528c-2.6 0-4.6 2.11-4.6 4.85 0 2.42 1.7 4.53 4.1 4.75 0 0 17 .95 17.3-2.64.3-3.38-7.5-2.85-14.5-6.44z"/>
                                    </g>
                                </g>
                                </g>
        
                                <g id="thighleft" fill='#DC0026'>
                                    <path d="M169.2 223.345c.1-.21-.4-2.11 1.4-20.466-1.9-15.51-4.6-39.88-1.2-52.86 2.9-12.66 16.7-15.83 19.1-1.588.4 11.183.4 15.51-2 35.66-4.6 23.313-9.7 39.243-9.8 40.09-.1.525-2.2 2.32-4.4 2.002-1.7.104-3.3-2.217-3.1-2.85z"/>
                                    <g class="F1" id="shankleft">
                                        <path  d="M162.9 307.954s1.2-11.393.3-24.264c-.5-9.284-5.8-30.594-4.7-38.93 6.8-18.777 13.6-23.42 16.4-22.26 1.1.95 1.9 2.322 1.3 4.01-.1.106-3.8 23.632-6 40.3-2.3 18.04.7 41.144.7 41.144h-8z"/>
                                        <g class="F2" id="footleft">
                                        <path d="M192.2 316.183s-25.4-16.985-28.8-14.242c-1.4 6.65-11.8 19.1-2.9 22.9 3.3 1.27 7-1.16 8.3-1.37 6.3-1.16 19.1 1.48 20.2 1.48 2.8 0 5.1-1.687 5.1-4.64 0-1.69-.8-3.27-1.9-4.116z"/>
                                        <path class="F3" d="M191.7 315.867s-1.5-.528-2.3-.528c-2.6 0-4.6 2.11-4.6 4.85 0 2.42 1.7 4.53 4.1 4.75 0 0 17 .95 17.3-2.64.3-3.38-7.5-2.85-14.5-6.44z"/>
                                        </g>
                                    </g>
                                </g>
        
        
                                <path fill='#333' d="M191.1 49.9l-18.9-3.7c-.9-.1-1.2-1.1-.6-1.6l1.9-2.3c.2-.3.7-.4 1.1-.3l16.7 5.7c-.1-.1-.2 2.2-.2 2.2z"/>
                                <g id="HF">
                                <path d="M179.9 111.275c.5-1.88 7.2-21.42 6.3-36.154 4.4-10.76 2-18.49.7-21.42-3.1-7-13.2-5.74-14.6 4.29-.5 3.66-1.5 10.87 2 19.33-2.6 17.24.7 31.87.9 33.96s4.1 1.988 4.7 0"/>
                                <g class="H1">
                                    <path d="M185 122.56c-.5-3.135-4.4-17.137-8.8-16.3-2.1.417-3.3 12.016-3.3 12.016 1.5 11.39 6.533 25.093 10.333 35.96l4.567-.852c.2 0-2.5-14.628-2.8-30.824z"/>
                                    <path class="H2" d="M186.87 152.17c-1 .11-2.9.774-4 .885-.6.11-2 4.318-2.8 7.308-.4 1.44-1 8.083-1 9.633l.4 6.312s1.5 5.315 1.8 5.98c.5 1.55 1.4.664 1.4.664s1.3 3.22 1.4 3.55c.3.67.8.89 1.3.78 2.3-.44-.1-5.09-.9-7.192.2-1.44-.3-4.872-.3-4.872s1 6.2 1.1 6.756c.1 1.77 2.1 4.87 2.4 5.87.1.995 1.6 1.327 2.4.44 1.7-1.88-1.8-6.53-1.8-6.53.4-2.216-.7-7.53-.7-7.53s1.5 9.52 2.2 11.736c.1.333 1.1 4.984 1.3 5.205.3.554 1 .554 1.5.333 2.2-1.33.7-6.866.2-7.862-.1-.33-.1-4.32-.7-7.75.15-4.882-.227-5.843-.8-7.64s.9 3.544 1.5 4.54c.04 4.22 2.277 7.61 4.355 6.67.8-.663.19-5.314-.555-8.552l-2.4-7.525c.2.33-6.2-11.3-7.3-11.19v-.028z"/>
                                </g>
                                </g>
                            </g>
                        </svg>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title text-center">Thigh</h3>
                    </div>
                    <div class="panel-body" style="height:177px">
                        <div id="thighchart" style="width: 100%; height: 100%;display: block;"></div> 
                    </div>
                </div>
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title text-center">Shank</h3>
                    </div>
                    <div class="panel-body" style="height:177px">
                        <div id="shankchart" style="width: 100%; height: 100%;display: block;"></div> 
                    </div>
                </div>
            </div>
            <div class="col-lg-2">
                <div class="panel panel-success">
                    <div class="panel-heading">
                        <h3 class="panel-title text-center">Displacement</h3>
                    </div>
                    <div class="panel-body" style="height:415px">
                        <div id="displacementchart" style="width: 100%; height: 100%;display: block;"></div> 
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/canvasjs.min.js"></script>
    <script src="js/papaparse.min.js"></script>
    <script src="minified/TweenMax.min.js"></script>
    <script>
        $(function() {

            // We can attach the `fileselect` event to all file inputs on the page
            $(document).on('change', ':file', function() {
                var input = $(this),
                    numFiles = input.get(0).files ? input.get(0).files.length : 1,
                    label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
                    input.trigger('fileselect', [numFiles, label]);
                    f = input.get(0).files[0]
                    Papa.parse(f,{
                        complete : handler
                });
            });
            // We can watch for our custom `fileselect` event like this
            $(document).ready( function() {
                $(':file').on('fileselect', function(event, numFiles, label) {
                    var input = $(this).parents('.input-group').find(':text'),
                        log = numFiles > 1 ? numFiles + ' files selected' : label;
                    if( input.length ) {
                        input.val(log);
                    } else {
                        if( log ) alert(log);
                    }

                });
            });

        });


        var handler = function(results){
            console.log(results)

            var thighright = document.getElementById("thighright");
            var shankright = document.getElementById("shankright");
            var footright = document.getElementById("footright");
            var B = document.getElementById("B");

            var thighx = results.data.map(function(d){return {y:parseFloat(d[0])}})
            var thighy = results.data.map(function(d){return {y:parseFloat(d[1])}})
            var shankx = results.data.map(function(d){return {y:parseFloat(d[3])}})
            var shanky = results.data.map(function(d){return {y:parseFloat(d[4])}})
            var footx = results.data.map(function(d){return {y:parseFloat(d[6])}})
            var footy = results.data.map(function(d){return {y:parseFloat(d[7])}})
            var displacement = results.data.map(function(d){return {y:parseFloat(d[9]),x:parseFloat(d[10])}})
            
            var L = 83.6, initTheta = -6.86999, initBeta = -2.095, L2 = 82.05;
            var upperL = 89, lowL = 106, delay = 60;
            var TIMEGAP = 0.01;
            var twl = TweenLite, E0=Sine.easeInOut , E1=Sine.easeIn , E2=Sine.easeOut ;
            var tl1 = new TimelineMax({repeat:-1}); 




            twl.set(thighright,{transformOrigin:"50% top"});
            twl.set(shankright,{transformOrigin:"50% top"});
            twl.set(footright,{transformOrigin:"25% top"});

            twl.set(thighleft,{transformOrigin:"50% top"});
            twl.set(shankleft,{transformOrigin:"50% top"});
            twl.set(footleft,{transformOrigin:"25% top"});
            

            for(var i=0,len=results.data.length-1;i<len;i++){
                tl1.to(thighright,TIMEGAP,{rotation:-thighy[i].y,ease:E0})
                    .to(shankright,TIMEGAP,{rotation:-shanky[i].y+thighy[i].y,ease:E0},"-=0.01")
                    // .to(footright,TIMEGAP,{rotation:-footy[i].y,ease:E0},"-=0.01");
                
                if(i>=delay){
                    tl1.to(thighleft,TIMEGAP,{rotation:-thighy[i-delay].y,ease:E0},"-=0.01")
                    .to(shankleft,TIMEGAP,{rotation:-shanky[i-delay].y+thighy[i-delay].y,ease:E0},"-=0.01")
                    // .to(footleft,TIMEGAP,{rotation:-footy[i-delay].y,ease:E0},"-=0.01");
                    
                    var delta1 = upperL + lowL - upperL*Math.cos(thighy[i].y*Math.PI/180) - lowL*Math.cos(shanky[i].y*Math.PI/180);
                    var delta2 = upperL + lowL - upperL*Math.cos((thighy[i-delay].y)*Math.PI/180) - lowL*Math.cos((shanky[i-delay].y)*Math.PI/180);
                    var delta = delta1 < delta2 ? delta1:delta2
                    tl1.to(B,TIMEGAP,{y:delta},"-=0.01")

                }
            }
            tl1.time(0.1);

            var charts = new Array(3), index = 0;                        
            charts[0] = new CanvasJS.Chart("thighchart",{
                animationEnabled: true,
                // theme: "light2",
                data: [
                    {    
                        color: "LightSeaGreen",
                        type: "spline",
                        dataPoints: thighy
                    }
                ]
            });
            charts[0].render();

            charts[1] = new CanvasJS.Chart("shankchart",{
                animationEnabled: true,
                // theme: "light2",
                data: [
                    {    
                        color: "LightSeaGreen",
                        type: "spline",
                        dataPoints: shanky
                    }
                ]
            });
            charts[1].render();
            charts[2] = new CanvasJS.Chart("displacementchart",{
                animationEnabled: true,
                // title: {
                //     text: "Thigh Chart"
                // },
                data: [
                    {    
                        color: "LightSeaGreen",
                        type: "spline",
                        dataPoints: displacement
                    }
                ]
            });
            charts[2].render();                        

            function reset(chart){
                for(var i=0,len=chart.data[0].dataPoints.length;i<len;i++){
                    chart.data[0].dataPoints[i].color = "LightSeaGreen";
                    chart.data[0].dataPoints[i].lineColor = "LightSeaGreen";                                
                }
            }


            var movetarget = function(){
                if(charts[0] == null || charts[1] == null || charts[2] == null){
                    console.log("switch 1");
                }
                else{
                    for(var j=0;j<10;j++){
                        index = (index+1)%charts[0].data[0].dataPoints.length;
                        if(index == 0){
                            for(var i=0;i<charts.length;i++){
                                reset(charts[i]);
                            }
                        }else{
                            charts.forEach(function(d){
                                d.data[0].dataPoints[index].color = "red";
                                d.data[0].dataPoints[index].lineColor = "red";
                            });
                            // console.log(Date.now())
                        }
                    }
                    charts.forEach(function(d){
                        d.render();
                    });
                }                            
            }


            setInterval(movetarget,100); 
        }
    </script>
</body>
</html>